#! /bin/sh
#
# EFS-плагин для Midnight Commander
#
# Сюда надо вписать путь и имя программы qefs, а также, если надо, ключ -p для указания конкретного порта
#
qefs="/usr/share/qtools/qefs -p0"

#***********************************
# Получение списка файлов
#***********************************

efs_list() {
$qefs -lm $1 
}

#***********************************
# Извлечение файлов
#***********************************
efs_copyout() {
$qefs -gf $2 $3
}

#***********************************
# Запись файлов
#***********************************
efs_copyin() {
$qefs -wf $3 $2
}

#***********************************
# Удаление файлов
#***********************************
efs_rm() {
$qefs -ef $2
}

#***********************************
# Создание каталога
#***********************************
efs_mkdir() {
$qefs -md $2 rwx
}

#***********************************
# Удаление каталога
#***********************************
efs_rmdir() {
$qefs -ed $2 
}


umask 077

cmd="$1"
shift

case "$cmd" in
#  list)    efs_list    "$@" | sort -k 8 ;;
  list)    efs_list    "$@" ;;
  rm)      efs_rm      "$@" ;;
  rmdir)   efs_rmdir   "$@" ;;
  mkdir)   efs_mkdir   "$@" ;;
  copyin)  efs_copyin  "$@" ;;
  copyout) efs_copyout "$@" ;;
  *) exit 1 ;;
esac
exit 0
